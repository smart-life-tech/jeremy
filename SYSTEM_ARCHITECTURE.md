# System Architecture & Data Flow

## Hardware Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ESP32-S3 MICROCONTROLLER                     â”‚
â”‚                    (240MHz Dual Core, 8MB Flash)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
   GPIO        I2C Bus    GPIO/ADC   Display    Power    WiFi
    â”‚        (8-9)       (GPIO6)   Interface  Management
    â”‚        100kHz      3.3V ADC   (RGB)      (Dual Li-Po)
    â”‚          â”‚                    GPIO0-5      â”‚
    â”‚          â”‚                      â”‚          â”‚
    â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
      â”‚        â”‚                      â”‚          â”‚
      â”‚        â”‚                      â”‚          â”‚
      â”‚   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚
      â”‚   â”‚ I2C Sensor Bus          â”‚ â”‚          â”‚
      â”‚   â”‚ (100kHz, Bus A)         â”‚ â”‚          â”‚
      â”‚   â”‚                         â”‚ â”‚          â”‚
      â”‚   â”œâ”€ SCD41 (0x62)           â”‚ â”‚          â”‚
      â”‚   â”‚  â””â”€ COâ‚‚, Temp, Humidity â”‚ â”‚          â”‚
      â”‚   â”‚                         â”‚ â”‚          â”‚
      â”‚   â”œâ”€ BME680 (0x77)          â”‚ â”‚          â”‚
      â”‚   â”‚  â””â”€ VOC, IAQ, Env       â”‚ â”‚          â”‚
      â”‚   â”‚                         â”‚ â”‚          â”‚
      â”‚   â”œâ”€ ADS1115 (0x48)         â”‚ â”‚          â”‚
      â”‚   â”‚  â””â”€ A0: Battery voltage â”‚ â”‚          â”‚
      â”‚   â”‚  â””â”€ A1: MiCS CO         â”‚ â”‚          â”‚
      â”‚   â”‚  â””â”€ A2: MiCS NHâ‚ƒ        â”‚ â”‚          â”‚
      â”‚   â”‚  â””â”€ A3: MiCS NOâ‚‚        â”‚ â”‚          â”‚
      â”‚   â”‚                         â”‚ â”‚          â”‚
      â”‚   â””â”€ CH422G (I2C)           â”‚ â”‚          â”‚
      â”‚      â””â”€ Backlight control   â”‚ â”‚          â”‚
      â”‚                             â”‚ â”‚          â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚
                                       â”‚          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                    â”‚                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Waveshare 4.3"â”‚          â”‚   10000mAh LiPo â”‚
            â”‚  LCD Display   â”‚          â”‚  Battery Pack   â”‚
            â”‚  (800Ã—480)     â”‚          â”‚  (3.7V nominal) â”‚
            â”‚  RGB Parallel  â”‚          â”‚                 â”‚
            â”‚  GT911 Touch   â”‚          â”‚ - Main supply   â”‚
            â”‚                â”‚          â”‚ - GPIO6 sense   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sensor Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOCAL DATA PROCESSING                      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   SCD41      â”‚  â”‚   MiCS-6814  â”‚  â”‚   BME680       â”‚    â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                â”‚    â”‚
â”‚  â”‚ â€¢ COâ‚‚ (ppm)  â”‚  â”‚ â€¢ CO (V)      â”‚  â”‚ â€¢ VOC Index    â”‚    â”‚
â”‚  â”‚ â€¢ Temp (Â°C)  â”‚  â”‚ â€¢ NHâ‚ƒ (V)     â”‚  â”‚ â€¢ IAQ Score    â”‚    â”‚
â”‚  â”‚ â€¢ Humidity   â”‚  â”‚ â€¢ NOâ‚‚ (V)     â”‚  â”‚ â€¢ Pressure     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ Temp/Hum     â”‚    â”‚
â”‚         â”‚                 â”‚           â”‚                â”‚    â”‚
â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚    â”‚            â”‚                    â”‚             â”‚
â”‚         â”œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”‚
â”‚         â”‚           â”‚            â”‚                 â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCALING & UNIT CONVERSION  â”‚ â”‚   â”‚  CALIBRATION DATA  â”‚ â”‚
â”‚  â”‚                             â”‚ â”‚   â”‚                    â”‚ â”‚
â”‚  â”‚ â€¢ PPM conversions           â”‚ â”‚   â”‚ â€¢ Baseline valid   â”‚ â”‚
â”‚  â”‚ â€¢ Ratio calculations        â”‚ â”‚   â”‚ â€¢ Baseline values  â”‚ â”‚
â”‚  â”‚ â€¢ Temperature offset        â”‚ â”‚   â”‚ â€¢ Calib timestamp  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                        â”‚                â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚            â”‚  FILTERING & SMOOTHINGâ”‚                         â”‚
â”‚            â”‚                      â”‚                         â”‚
â”‚            â”‚ â€¢ Median filter      â”‚                         â”‚
â”‚            â”‚ â€¢ Moving average     â”‚                         â”‚
â”‚            â”‚ â€¢ Clamp/reject bad   â”‚                         â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â”‚                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚            â”‚  COMPOSITE SCORING   â”‚                         â”‚
â”‚            â”‚                      â”‚                         â”‚
â”‚            â”‚ Air Quality (0-100%) â”‚                         â”‚
â”‚            â”‚ Exposure Index       â”‚                         â”‚
â”‚            â”‚ Safety Status        â”‚                         â”‚
â”‚            â”‚ Data Quality Score   â”‚                         â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â”‚                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚            â”‚  ALERT EVALUATION    â”‚                         â”‚
â”‚            â”‚                      â”‚                         â”‚
â”‚            â”‚ â€¢ Level 0-3          â”‚                         â”‚
â”‚            â”‚ â€¢ Triggered gas      â”‚                         â”‚
â”‚            â”‚ â€¢ Color coding       â”‚                         â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Display â”‚   â”‚ ESPHome  â”‚   â”‚  Local  â”‚
    â”‚ (LVGL)  â”‚   â”‚   API    â”‚   â”‚ Storage â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚
         â”‚              â–¼              â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚         â”‚ Home        â”‚     â”‚
         â”‚         â”‚ Assistant   â”‚     â”‚
         â”‚         â”‚ 15+ sensors â”‚     â”‚
         â”‚         â”‚ 6+ binary   â”‚     â”‚
         â”‚         â”‚ alerts      â”‚     â”‚
         â”‚         â”‚ Automations â”‚     â”‚
         â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚              â”‚              â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”
         â”‚ Mobile  â”‚    â”‚ Logging  â”‚
         â”‚ Notify  â”‚    â”‚ Database â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sensor Specifications Matrix

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Sensor           â•‘  Purpose   â•‘  Technologyâ•‘  Accuracy     â•‘  Response    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ SCD41             â•‘ COâ‚‚        â•‘ NDIR       â•‘ Â±40 ppm       â•‘ 5 sec        â•‘
â•‘                   â•‘ + Env      â•‘ (Infrared) â•‘ Â±0.8Â°C        â•‘ (calibrated) â•‘
â•‘                   â•‘            â•‘            â•‘ Â±6% RH        â•‘              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ MiCS-6814         â•‘ CO         â•‘ Metal Oxideâ•‘ Â±10%          â•‘ 1 sec (raw)  â•‘
â•‘                   â•‘ NHâ‚ƒ        â•‘ Semicon.   â•‘ (depends on   â•‘ 5-10 sec     â•‘
â•‘                   â•‘ NOâ‚‚        â•‘ (MOS)      â•‘ baseline)     â•‘ (filtered)   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ BME680            â•‘ VOC/IAQ    â•‘ BSEC       â•‘ Â±15%          â•‘ 5 sec        â•‘
â•‘                   â•‘ Pressure   â•‘ (Bosch)    â•‘ Â±3% RH        â•‘ (smoothed)   â•‘
â•‘                   â•‘ + Env      â•‘            â•‘ Â±1 hPa        â•‘              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ADS1115           â•‘ Battery    â•‘ 16-bit     â•‘ Â±0.1 mV       â•‘ 2 sec        â•‘
â•‘                   â•‘ Voltage    â•‘ SAR ADC    â•‘ (raw)         â•‘              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Calibration & Baseline System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CALIBRATION STATE MACHINE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    START
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  POWER ON        â”‚
            â”‚  Load baseline   â”‚
            â”‚  from flash      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚
         â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Baseline â”‚          â”‚ Baseline â”‚
    â”‚ VALID    â”‚          â”‚ INVALID  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚                 â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚ PPM readings    â”‚
         â”‚                 â”‚ return NAN      â”‚
         â”‚                 â”‚                 â”‚
         â”‚                 â”‚ Display: "NOT   â”‚
         â”‚                 â”‚ CALIBRATED"     â”‚
         â”‚                 â”‚                 â”‚
         â”‚                 â”‚ User must press â”‚
         â”‚                 â”‚ "Calibrate"     â”‚
         â”‚                 â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚ User calibrates  â”‚
         â”‚                â”‚ outdoors in      â”‚
         â”‚                â”‚ clean air        â”‚
         â”‚                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚ Current voltages  â”‚
         â”‚                â”‚ stored as baselineâ”‚
         â”‚                â”‚ (3 floats)        â”‚
         â”‚                â”‚ Saved to flash    â”‚
         â”‚                â”‚ Counter++         â”‚
         â”‚                â”‚ Timestamp update  â”‚
         â”‚                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ GAS MONITORING ACTIVE   â”‚
         â”‚                         â”‚
         â”‚ â€¢ CO = V / V_baseline   â”‚
         â”‚ â€¢ NHâ‚ƒ = V / V_baseline  â”‚
         â”‚ â€¢ NOâ‚‚ = V / V_baseline  â”‚
         â”‚                         â”‚
         â”‚ All in PPM or ratio     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚
            â–¼                â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Normal   â”‚    â”‚ Calibration  â”‚
      â”‚ Operationâ”‚    â”‚ Age >14 days?â”‚
      â”‚          â”‚    â”‚              â”‚
      â”‚ Readings â”‚    â”‚ YES: Warning â”‚
      â”‚ valid    â”‚    â”‚     (optional)
      â”‚          â”‚    â”‚              â”‚
      â”‚ Display  â”‚    â”‚ Reset button â”‚
      â”‚ PPM      â”‚    â”‚ available    â”‚
      â”‚ values   â”‚    â”‚              â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Alert System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REAL-TIME ALERT EVALUATION                      â”‚
â”‚              (Every 5 seconds)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        SENSOR DATA
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ COâ‚‚ Scoring      â”‚
    â”‚ â€¢ 400-600: 0pts  â”‚
    â”‚ â€¢ 600-1200: 5pts â”‚
    â”‚ â€¢ 1200-2000: 15pts
    â”‚ â€¢ >2000: 40pts   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ VOC/IAQ Scoring  â”‚
    â”‚ â€¢ 0-150: 0pts    â”‚
    â”‚ â€¢ 150-300: 10pts â”‚
    â”‚ â€¢ 300-400: 30pts â”‚
    â”‚ â€¢ >400: 50pts    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Gas Scoring      â”‚
    â”‚ (if calibrated)  â”‚
    â”‚ â€¢ CO ratio       â”‚
    â”‚ â€¢ NHâ‚ƒ ratio      â”‚
    â”‚ â€¢ NOâ‚‚ ratio      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Composite Score  â”‚
    â”‚ 0-100%           â”‚
    â”‚ (weighted avg)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€ >75% â†’ Level 0 (Normal, Green)
             â”‚
             â”œâ”€ 50-75% â†’ Level 1 (Warning, Yellow)
             â”‚
             â”œâ”€ 25-50% â†’ Level 2 (Alert, Orange)
             â”‚
             â””â”€ <25% â†’ Level 3 (Critical, Red)

             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Specific Triggersâ”‚
    â”‚ (All checked)    â”‚
    â”‚                  â”‚
    â”‚ â€¢ CO >100 ppm    â”‚
    â”‚ â€¢ NHâ‚ƒ >150 ppm   â”‚
    â”‚ â€¢ NOâ‚‚ >10 ppm    â”‚
    â”‚ â€¢ COâ‚‚ >2000 ppm  â”‚
    â”‚ â€¢ Score <10%     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Generate Alerts  â”‚
    â”‚                  â”‚
    â”‚ HA Binary Sensorsâ”‚
    â”‚ HA Notifications â”‚
    â”‚ Display Update   â”‚
    â”‚ Siren/Lights(opt)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Home Assistant Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               HOME ASSISTANT ECOSYSTEM                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    ESP32-S3
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚
          â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ESPHome API â”‚         â”‚ MQTT Optionalâ”‚
    â”‚ (Native)    â”‚         â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Home Assistant Core             â”‚
    â”‚                                     â”‚
    â”‚  â€¢ 15+ Sensor entities (auto)        â”‚
    â”‚  â€¢ 6+ Binary sensor entities         â”‚
    â”‚  â€¢ Configuration complete            â”‚
    â”‚  â€¢ No YAML editing needed            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚           â”‚          â”‚
        â–¼              â–¼           â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Automations
    â”‚         â”‚   â”‚ Service â”‚ â”‚ Loggingâ”‚ â”‚Frontendâ”‚
    â”‚ Triggersâ”‚   â”‚ Calls   â”‚ â”‚Databaseâ”‚ â”‚Lovelaceâ”‚
    â”‚ Actions â”‚   â”‚(fan on) â”‚ â”‚(InfluxDB)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚              â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                    â”‚ Mobile  â”‚    â”‚ Lights/ â”‚
                    â”‚ Notify  â”‚    â”‚ Switchesâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Display UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          AIR QUALITY DASHBOARD (LVGL)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Title: AIR QUALITY MONITOR                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  â”‚    â”‚ COâ‚‚   â”‚ â”‚ VOC/IAQ  â”‚ â”‚
â”‚  â”‚  Overall Score   â”‚    â”‚ 1240  â”‚ â”‚  382     â”‚ â”‚
â”‚  â”‚   ðŸŸ¢ 78%         â”‚    â”‚ ppm   â”‚ â”‚  IAQ     â”‚ â”‚
â”‚  â”‚                  â”‚    â”‚       â”‚ â”‚  72Â°F    â”‚ â”‚
â”‚  â”‚  GOOD            â”‚    â”‚Excellent
  â”‚ Fair     â”‚ â”‚
â”‚  â”‚                  â”‚    â”‚       â”‚ â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ TOXIC GAS SENSORS (Calibrated)             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ CO         â”‚ NHâ‚ƒ          â”‚ NOâ‚‚            â”‚ â”‚
â”‚  â”‚ 5 ppm      â”‚ 12 ppm       â”‚ 0.2 ppm        â”‚ â”‚
â”‚  â”‚ NORMAL     â”‚ NORMAL       â”‚ NORMAL         â”‚ â”‚
â”‚  â”‚ OSHA: 50   â”‚ OSHA: 50     â”‚ OSHA: 5        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                   â”‚
â”‚  Quality: 95% | Calib: VALID | Age: 3 days     â”‚
â”‚  AEI: 15.2 | WiFi: 85% | Uptime: 12h           â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Calibrate... â”‚      â”‚ Reset | â† Back   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Power Management

```
10000 mAh LiPo Battery (3.7V nominal)
â”‚
â”œâ”€ ESP32-S3 Processor ........... 160mA
â”œâ”€ All Sensors (I2C + ADC) ...... 50mA
â”œâ”€ Display + RGB Controller ... 1000-1500mA
â”œâ”€ Backlight (LED) ............ 500mA
â”œâ”€ WiFi TX Peak .............. 300mA (transient)
â”‚
â””â”€ AVERAGE CONSUMPTION:
   â€¢ Display ON, WiFi active: ~1.2A
   â€¢ Display OFF, WiFi active: ~200mA
   â€¢ Display ON, WiFi idle: ~1.0A
   â€¢ Full idle (screen saver): ~300mA

RUNTIME ESTIMATES:
â€¢ Continuous active: 8 hours
â€¢ With screen saver: 15-20 hours
â€¢ WiFi OFF: 40+ hours
â€¢ Charging: ~5 hours via USB-C or induction
```

---

## Data Quality & Uncertainty

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DATA QUALITY CALCULATION FLOWCHART           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Quality = 100%

Deductions:
â”œâ”€ Gas baseline not set? ........... -40%
â”œâ”€ SCD41 COâ‚‚ offline? .............. -15%
â”œâ”€ BME680 VOC offline? ............. -15%
â”œâ”€ Calibration >7 days old? ........ -10%
â”œâ”€ WiFi <50% signal? ............... -5%
â””â”€ (Can't go below 0%)

Example:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quality: 95%                       â”‚
â”‚ â””â”€ Baseline valid âœ“                â”‚
â”‚ â””â”€ All sensors alive âœ“            â”‚
â”‚ â””â”€ Calibration 3 days old âœ“       â”‚
â”‚ â””â”€ WiFi strong âœ“                  â”‚
â”‚ â†’ Data HIGHLY RELIABLE             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When <60% quality:
â€¢ Gas sensors show "NOT CALIBRATED"
â€¢ IAQ readings may be unreliable
â€¢ Recommend recalibration
â€¢ HA sends maintenance notification
```

---

**This architecture ensures:**
âœ… Real-time accurate monitoring
âœ… Professional safety standards
âœ… Home automation integration
âœ… Battery efficiency
âœ… Reliable calibration
âœ… Transparent data quality
âœ… Multi-level alerts
âœ… Historical logging
